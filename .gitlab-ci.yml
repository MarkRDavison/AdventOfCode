image: gcc

before_script:
    - apt-get update
    - apt-get -y install cmake
    - apt-get -y install python3 python3-pip
    - pip install conan
    - conan config set storage.path=./build

stages:
  - configure
  - build
  - test

configurestuff:
  stage: configure
  script:
   - mkdir build
   - cd build
   - conan install .. --build
   - cmake ..
  artifacts:
    paths:
     - build

buildstuff:
  stage: build
  script:
   - cd build
   - conan install .. --buildconan 
   - cmake --build .
  artifacts:
    paths:
     - build
  dependencies:
    - configurestuff

teststuff:
  stage: test
  script:
   - cd build
   - ctest . -C Debug
   - ./bin/main
  artifacts:
    paths:
     - build
  dependencies:
    - buildstuff